<div id="mbox">
  <div id="messages"></div> 
</div>
<form id="messageform">
  <input id="messageinput" placeholder="Send a message...">
</form>
<style>
  ::-webkit-scrollbar {
    width: 10px;
  }
  
  ::-webkit-scrollbar-track {
  }
   
  ::-webkit-scrollbar-thumb {
    background: black; 
    border-radius: 10px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: gray; 
  }
  
  ::placeholder{
    color:black;
  }
  #messageinput{
    width:70%;
    position:absolute;
    text-align:left;
    left:15%;
    bottom:10px;
    padding:10px;
    font-size:25px;
    color:black;
    border-color:black;
    background:transparent;
    border-radius:25px;
  }
  #messages{
    height:100%;
    position:absolute;
    left:5px;
    top:0px;
    width:40%;
  }
  #mbox{
    height:80%;
    position:absolute;
    left:0px;
    overflow-x:hidden;
    overflow-y:scroll;
    top:0px;
    width:100%;
  }
  .messagebox{
    display:flex;
    flex-direction:column;
    margin-bottom:15px;
  }
  .messagetext{
    width:fit-content;
    background: #8c8c8c;
    padding-left: 5px !important;
    padding: 7px;
    border-radius: 0 10px 10px;
    color: black;
  }
  .usertext{
    margin-left: 5px;
    margin-bottom:3px;
    color: black;
  }
  body{
    background:#c4c4c4;
  }
</style>
<script>
  var clientuser=localStorage.getItem("username");
  var clientpassword=localStorage.getItem("password");

  if (clientuser==undefined || clientuser==null){
    window.location.href="/signup";
  }
  
  function getText(file){
    return new Promise((resolve) => {
      fetch(file)
        .then((response) => {
          return response.text();
        })
        .then((txt) => {
          resolve(txt);
        });
    });
  }

  async function start(){
    
    var messages=await getText("https://server-dragon731012.koyeb.app/?val=r&group=hi");
    var messagelines=messages.toString().split("|");
    var messagejson={messages: []};
    for(var i=0;i<messagelines.length-1;i++){
      var tempjson={};
      tempjson.user=messagelines[i].split(":")[0];
      tempjson.message=messagelines[i].split(":")[1];
      messagejson.messages.push(tempjson);
    }
    for (var i=0;i<messagejson.messages.length;i++){
      var messagediv=document.createElement("div");
      if (messagejson.messages[i].user==clientuser){
        messagediv.style.width="200%";
        messagediv.style.alignItems="end";
      }
      messagediv.className="messagebox";
      messagediv.innerHTML="<div class='usertext'>"+messagejson.messages[i].user+"</div><div class='messagetext'>"+messagejson.messages[i].message+"</div>";
      document.getElementById("messages").appendChild(messagediv);
    }
  }
  start();

  document.getElementById("messageform").addEventListener("submit",async (e)=>{
    e.preventDefault();
    var sent=await getText("https://server-dragon731012.koyeb.app/?val=w&group=hi&user="+clientuser+"&text="+document.getElementById("messageinput").value+"&gp=hi&up="+clientpassword);
  });
</script>
